require 'pry'


#TODO switch mklink/ln betwen environments
desc "Removes old .bashrc/.vimrc and .vim files/folders in favour of links towards this folder"
task :install => [:bash_rc,:vim,:fonts,:tmux]

def on_windows?
  RUBY_PLATFORM =~ /mingw/
end

def fix_path(s)
  #c:/Users... => /c/Users...
  s.gsub(/c:/, "/c") if on_windows?
end

def current_dir 
  fix_path(Dir.pwd)
end

task :bash_rc do
  sh "rm -f ~/.bashrc"
  sh "ln -s #{current_dir}/.bashrc ~/.bashrc"
  sh "rm -f ~/.inputrc"
  sh "ln -s #{current_dir}/.inputrc ~/.inputrc"
end


desc "Setup vim"
task :vim do
  sh "rm -rf ~/.*vim*"
  sh "ln -s #{current_dir}/vim/vimrc ~/.vimrc"
  sh "ln -s #{current_dir}/vim ~/.vim"
  sh "sudo ln -s #{current_dir}/git/git-completion.bash /etc/bash_completion.d/git-completion"
end

task :fish do
  sh "ln -s #{current_dir}/fish ~/.config/fish"
end

task :tmux do
  sh "ln -s #{current_dir}/tmux.conf ~/.tmux.conf"
end

task :fonts do
  sh "rm -rf ~/.fonts"
  sh "sudo ln -s #{current_dir}/fonts ~/.fonts"
end

task :clojure do
  sh "export PATH=~/dotfiles/clojure/clj:$PATH"
  sh "sudo ln -s #{current_dir}/clojure/completions.clj ~/.completions"
end

namespace :irb do
  desc "Links irbrc to ~/.irbrc"
  task :install do
    sh "del ~/.irbrc" if File.exists? "~/.irbrc"
    sh "mklink \".irbrc\" \"~/.irbrc\""
  end
end
