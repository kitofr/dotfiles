require 'pry'

task :default => [:tmux,:vim,:fonts,:zsh]

#TODO switch mklink/ln betwen environments
desc "Removes old .bashrc/.vimrc and .vim files/folders in favour of links towards this folder"
task :install => [:bash_rc,:vim,:fonts,:tmux]

def on_windows?
  RUBY_PLATFORM =~ /mingw/
end

def fix_path(s)
  #c:/Users... => /c/Users...
  s.gsub(/c:/, "/c") if on_windows?
end

task :bash_rc do
  sh "rm -f ~/.bashrc"
  sh "ln -s #{pwd}/.bashrc ~/.bashrc"
  sh "rm -f ~/.inputrc"
  sh "ln -s #{pwd}/.inputrc ~/.inputrc"
end


desc "Setup vim"
task :vim do
  sh "rm -rf ~/.*vim*"
  sh "ln -s #{pwd}/vim/vimrc ~/.vimrc"
  sh "ln -s #{pwd}/vim ~/.vim"
  #sh "sudo ln -s #{pwd}/git/git-completion.bash /etc/bash_completion.d/git-completion"
end

def soft_link(source, dst)
  sh "rm -fr #{dst}" 
  sh "ln -s #{source} #{dst}"
end

task :zsh do
  soft_link "#{pwd}/zsh-themes/kitofr.zsh-theme", "~/.oh-my-zsh/themes/kitofr.zsh-theme"
end

task :tmux do
  soft_link "#{pwd}/tmux.conf", "~/.tmux.conf"
end

task :fonts do
  soft_link "#{pwd}/fonts", "~/.fonts"
end

task :clojure do
  sh "export PATH=~/dotfiles/clojure/clj:$PATH"
  sh "sudo ln -s #{pwd}/clojure/completions.clj ~/.completions"
end

namespace :irb do
  desc "Links irbrc to ~/.irbrc"
  task :install do
    sh "del ~/.irbrc" if File.exists? "~/.irbrc"
    sh "mklink \".irbrc\" \"~/.irbrc\""
  end
end
